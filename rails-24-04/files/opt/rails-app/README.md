# Rails 8.0.3 on DigitalOcean

This droplet comes pre-configured with Ruby on Rails 8.0.3 running in Docker containers with PostgreSQL database and Nginx reverse proxy.

## Quick Start

Your Rails application is automatically started and available at:
- **HTTP**: `http://your-droplet-ip`
- **Direct Rails**: `http://your-droplet-ip:3000` (if needed)

## Management Commands

All management scripts are located in `/opt/rails-app/`:

```bash
# Start the application
/opt/rails-app/start.sh

# Stop the application
/opt/rails-app/stop.sh

# Restart the application
/opt/rails-app/restart.sh

# View logs
/opt/rails-app/logs.sh

# Update application (rebuild containers)
/opt/rails-app/update.sh
```

## Application Structure

```
/opt/rails-app/
├── docker-compose.yml    # Docker Compose configuration
├── Dockerfile           # Rails container definition
├── nginx.conf          # Nginx reverse proxy config
├── .env               # Environment variables
├── Gemfile            # Ruby dependencies
├── app/               # Rails application code
├── config/            # Rails configuration
├── public/            # Static files (welcome page)
└── *.sh              # Management scripts
```

## Services

The application runs three Docker containers:

1. **web**: Rails 8.0.3 application server (Puma)
2. **db**: PostgreSQL 15 database
3. **nginx**: Nginx reverse proxy

## Environment Configuration

Edit `/opt/rails-app/.env` to modify configuration:

```bash
# Rails settings
RAILS_ENV=production
SECRET_KEY_BASE=<auto-generated>
RAILS_SERVE_STATIC_FILES=true
RAILS_LOG_TO_STDOUT=true

# Database settings
DATABASE_URL=postgresql://rails:<password>@db:5432/rails_production
POSTGRES_DB=rails_production
POSTGRES_USER=rails
POSTGRES_PASSWORD=<auto-generated>

# Server settings
PORT=3000
RAILS_MAX_THREADS=5
WEB_CONCURRENCY=2
```

After modifying the environment file, restart the application:
```bash
/opt/rails-app/restart.sh
```

## Development

To develop your Rails application:

1. **Access the application directory**:
   ```bash
   cd /opt/rails-app
   ```

2. **Edit your application code** in the standard Rails directories:
   - `app/` - Controllers, models, views
   - `config/` - Routes, application configuration
   - `db/` - Database migrations and seeds

3. **Run Rails commands** inside the container:
   ```bash
   docker-compose exec web bundle exec rails console
   docker-compose exec web bundle exec rails generate model User name:string
   docker-compose exec web bundle exec rails db:migrate
   ```

4. **Rebuild after major changes**:
   ```bash
   /opt/rails-app/update.sh
   ```

## Database Access

Access PostgreSQL database:
```bash
docker-compose exec db psql -U rails -d rails_production
```

## Logs

View application logs:
```bash
# All services
docker-compose logs -f

# Specific service
docker-compose logs -f web
docker-compose logs -f db
docker-compose logs -f nginx

# Or use the convenience script
/opt/rails-app/logs.sh
```

## Firewall

The following ports are configured in UFW:
- Port 80 (HTTP)
- Port 443 (HTTPS) 
- Port 3000 (Rails direct access)
- Port 22 (SSH - rate limited)

## Auto-Start

The application is configured to start automatically on boot via systemd service `rails-app.service`.

Check service status:
```bash
systemctl status rails-app.service
```

## Backups

Important data to backup:
- `/opt/rails-app/` - Application code and configuration
- Database: Use `pg_dump` to backup PostgreSQL data
- Docker volumes: `postgres_data`, `rails_storage`

## Troubleshooting

1. **Check service status**:
   ```bash
   docker-compose ps
   systemctl status rails-app.service
   ```

2. **View logs**:
   ```bash
   /opt/rails-app/logs.sh
   journalctl -u rails-app.service
   ```

3. **Restart services**:
   ```bash
   /opt/rails-app/restart.sh
   ```

4. **Check disk space**:
   ```bash
   df -h
   docker system df
   ```

5. **Clean up unused Docker resources**:
   ```bash
   docker system prune -f
   ```

## Support

- **Rails Documentation**: https://guides.rubyonrails.org/
- **Docker Compose**: https://docs.docker.com/compose/
- **DigitalOcean Docs**: https://docs.digitalocean.com/

---

**Rails Version**: 8.0.3  
**Ruby Version**: 3.4.7  
**Database**: PostgreSQL 15  
**Web Server**: Puma + Nginx